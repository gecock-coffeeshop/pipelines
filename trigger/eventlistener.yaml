apiVersion: tekton.dev/v1alpha1
kind: EventListener
metadata:
  name: event-listener
  namespace: coffeeshop-pipelines
spec:
  serviceAccountName: pipeline-service-account
  triggers:
    - name: staging-branch-trigger
      interceptors:
        - cel:
            filter: "header.match('X-GitHub-Event','push') && body.ref == 'refs/heads/staging'"
      bindings:
        - name: ref-branch-binding
        - name: git-binding
        - name: pipeline-staging-binding
      template:
        name: pipeline-template
    - name: prod-branch-trigger
      interceptors:
        - cel:
            filter: "header.match('X-GitHub-Event','push') && body.ref == 'refs/heads/prod'"
      bindings:
        - name: ref-branch-binding
        - name: git-binding
        - name: pipeline-prod-binding
      template:
        name: pipeline-template
    - name: master-trigger
      interceptors:
        - cel:
            filter: "header.match('X-GitHub-Event','push') && body.ref == 'refs/heads/master'"
      bindings:
        - name: master-branch-binding
        - name: git-binding
        - name: pipeline-dev-binding
      template:
        name: pipeline-template
